openapi: 3.0.3
info:
  title: SafeProject API
  version: 1.0.0
  description: |
    SafeProject 커뮤니티/인증/유저 API 명세서

servers:
  - url: https://safezone-h0u2.onrender.com
    description: Render server

tags:
  - name: Auth
    description: 인증 / 회원 관련 API
  - name: Users
    description: 내 정보 조회/수정/탈퇴 API
  - name: Bords
    description: 게시글(게시판) API
  - name: Comments
    description: 댓글 / 대댓글 API

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      properties:
        statusCode:
          type: integer
        error:
          type: string
        message:
          type: string

    BordCategory:
      type: string
      enum: [inquiry, free, report]

    Bord:
      type: object
      properties:
        id:
          type: integer
          example: 3
        title:
          type: string
          example: 테스트 게시글 제목입니다
        content:
          type: string
          example: 게시판 기능 테스트용 내용입니다.
        category:
          $ref: '#/components/schemas/BordCategory'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        userId:
          type: integer
          example: 1
        authorUser:
          type: object
          properties:
            id:
              type: integer
              example: 1
            nickname:
              type: string
              example: testUser
        _count:
          type: object
          properties:
            comments:
              type: integer
              example: 2

    BordListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Bord'
        page:
          type: integer
          example: 1
        pageSize:
          type: integer
          example: 10
        totalCount:
          type: integer
          example: 25
        totalPages:
          type: integer
          example: 3

    Comment:
      type: object
      properties:
        id:
          type: integer
          example: 1
        bordId:
          type: integer
          example: 3
        userId:
          type: integer
          example: 1
        content:
          type: string
          example: 첫 번째 댓글입니다.
        parentId:
          type: integer
          nullable: true
          example: null
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
        authorUser:
          type: object
          properties:
            id:
              type: integer
              example: 1
            nickname:
              type: string
              example: testUser
        replies:
          type: array
          items:
            $ref: '#/components/schemas/Comment'

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: 테스트유저
        nickname:
          type: string
          example: testUser
        email:
          type: string
          format: email
          example: testuser@example.com
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test-access-token
        refreshToken:
          type: string
          description: JWT refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test-refresh-token

paths:
  /api/bords:
    get:
      tags: [Bords]
      summary: 게시글 목록 조회
      description: |
        게시글 목록을 페이지네이션과 검색 조건으로 조회합니다.
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: 페이지 번호 (1부터 시작, 1 미만이면 400)
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 10
          description: 페이지 당 개수 (1 미만이면 400)
        - in: query
          name: category
          schema:
            $ref: '#/components/schemas/BordCategory'
          description: 카테고리별 필터 (inquiry, free, report)
        - in: query
          name: searchType
          schema:
            type: string
            enum: [title, content, title_content, author]
          description: 검색 타입 (제목/내용/제목+내용/작성자 닉네임)
        - in: query
          name: keyword
          schema:
            type: string
          description: 검색 키워드
      responses:
        '200':
          description: 게시글 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BordListResponse'
        '400':
          description: 잘못된 요청 (page, pageSize가 1 미만인 경우 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: page, pageSize는 1 이상의 정수여야 합니다.

    post:
      tags: [Bords]
      summary: 게시글 작성
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, content, category]
              properties:
                title:
                  type: string
                  example: 테스트 게시글입니다
                content:
                  type: string
                  example: 게시판 기능 테스트용 내용입니다.
                category:
                  $ref: '#/components/schemas/BordCategory'
      responses:
        '201':
          description: 게시글 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bord'
        '400':
          description: 잘못된 요청 (제목/내용 미입력, 유효하지 않은 카테고리 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 제목과 내용을 입력해주세요.
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.

  /api/bords/{bordId}:
    get:
      tags: [Bords]
      summary: 게시글 상세 조회 (댓글 포함)
      parameters:
        - in: path
          name: bordId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 게시글 상세 조회 성공 (댓글, 대댓글 포함)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Bord'
                  - type: object
                    properties:
                      comments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'
        '404':
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 게시글을 찾을 수 없습니다.

    patch:
      tags: [Bords]
      summary: 게시글 수정 (작성자 + 로그인 필요)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: bordId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: 수정된 테스트 게시글 제목입니다
                content:
                  type: string
                  example: 수정된 테스트 게시글 내용입니다.
                category:
                  $ref: '#/components/schemas/BordCategory'
      responses:
        '200':
          description: 게시글 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bord'
        '400':
          description: 잘못된 요청 (유효하지 않은 카테고리 값 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 유효하지 않은 카테고리입니다.
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '403':
          description: 수정 권한 없음 (작성자가 아닌 사용자가 수정 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 403
                error: Forbidden
                message: 게시글 수정 권한이 없습니다.
        '404':
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 게시글을 찾을 수 없습니다.

    delete:
      tags: [Bords]
      summary: 게시글 삭제 (작성자 + 로그인 필요)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: bordId
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: 게시글 삭제 성공 (댓글/대댓글도 함께 삭제)
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '403':
          description: 삭제 권한 없음 (작성자가 아닌 사용자가 삭제 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 403
                error: Forbidden
                message: 게시글 삭제 권한이 없습니다.
        '404':
          description: 게시글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 게시글을 찾을 수 없습니다.

  /api/comments/{bordId}:
    post:
      tags: [Comments]
      summary: 댓글 / 대댓글 작성
      description: |
        `parentId`가 `null`이면 최상위 댓글, 값이 있으면 해당 댓글의 대댓글로 작성됩니다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: bordId
          required: true
          schema:
            type: integer
          description: 댓글을 작성할 게시글 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  example: 첫 번째 댓글입니다.
                parentId:
                  type: integer
                  nullable: true
                  example: null
      responses:
        '201':
          description: 댓글 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          description: |
            잘못된 요청  
            - 댓글 내용 미입력/공백  
            - 유효하지 않은 부모 댓글(parentId)인 경우 등
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 유효하지 않은 부모 댓글입니다.
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '404':
          description: 게시글을 찾을 수 없음 (bordId에 해당하는 게시글이 없는 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 게시글을 찾을 수 없습니다.

  /api/comments/{commentId}:
    patch:
      tags: [Comments]
      summary: 댓글 수정
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: commentId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  example: 수정된 댓글 내용입니다.
      responses:
        '200':
          description: 댓글 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          description: 댓글 내용 미입력/공백 등 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 댓글 내용을 입력해주세요.
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '403':
          description: 수정 권한 없음 (작성자가 아닌 사용자가 수정 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 403
                error: Forbidden
                message: 댓글 수정 권한이 없습니다.
        '404':
          description: 댓글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 댓글을 찾을 수 없습니다.

    delete:
      tags: [Comments]
      summary: 댓글 삭제 (대댓글 포함)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: commentId
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: 댓글 삭제 성공 (대댓글도 함께 삭제)
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '403':
          description: 삭제 권한 없음 (작성자가 아닌 사용자가 삭제 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 403
                error: Forbidden
                message: 댓글 삭제 권한이 없습니다.
        '404':
          description: 댓글을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 댓글을 찾을 수 없습니다.

  /api/auth/email/send:
    post:
      tags: [Auth]
      summary: 이메일 인증코드 발송
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, purpose]
              properties:
                email:
                  type: string
                  format: email
                  example: testuser@example.com
                purpose:
                  type: string
                  enum: [signup, reset_password]
                  example: signup
      responses:
        '200':
          description: 인증코드 발송 완료
        '400':
          description: 잘못된 요청 (이메일 형식 오류, purpose 값 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 잘못된 요청입니다.

  /api/auth/email/verify:
    post:
      tags: [Auth]
      summary: 이메일 인증코드 검증
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, code, purpose]
              properties:
                email:
                  type: string
                  format: email
                  example: testuser@example.com
                code:
                  type: string
                  example: "123456"
                purpose:
                  type: string
                  enum: [signup, reset_password]
                  example: signup
      responses:
        '200':
          description: 인증 성공
        '400':
          description: |
            잘못된 요청 또는 인증 실패  
            - 인증 정보 없음  
            - 코드 불일치  
            - 인증 코드 만료 등
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 인증 코드가 일치하지 않습니다.

  /api/auth/register:
    post:
      tags: [Auth]
      summary: 회원가입
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, nickname, email, password, confirmPassword]
              properties:
                name:
                  type: string
                  example: 테스트유저
                nickname:
                  type: string
                  example: testUser
                email:
                  type: string
                  format: email
                  example: testuser@example.com
                password:
                  type: string
                  format: password
                  example: Testpass123!
                confirmPassword:
                  type: string
                  format: password
                  example: Testpass123!
      responses:
        '201':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: |
            잘못된 요청 또는 유효성 검사 실패  
            - 이메일 인증 미완료  
            - 비밀번호 형식 오류  
            - 비밀번호/재확인 불일치 등
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 이메일 인증이 필요합니다.
        '409':
          description: 이메일 또는 닉네임 중복 (이미 존재하는 이메일/닉네임)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 409
                error: Conflict
                message: 이미 존재하는 이메일입니다.

  /api/auth/login:
    post:
      tags: [Auth]
      summary: 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: testuser@example.com
                password:
                  type: string
                  format: password
                  example: Testpass123!
      responses:
        '200':
          description: 로그인 성공 (액세스/리프레시 토큰 발급)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '400':
          description: 잘못된 요청 (요청 형식 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 잘못된 요청입니다.
        '401':
          description: 비밀번호가 일치하지 않는 경우
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 비밀번호가 일치하지 않습니다.
        '404':
          description: 존재하지 않는 사용자 (이메일 미등록)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 존재하지 않는 사용자입니다.

  /api/auth/logout:
    post:
      tags: [Auth]
      summary: 로그아웃
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 로그아웃 성공 (리프레시 토큰 삭제)
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
        '404':
          description: 사용자를 찾을 수 없음 (이미 삭제된 계정 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 사용자를 찾을 수 없습니다.

  /api/auth/refresh:
    post:
      tags: [Auth]
      summary: 토큰 재발급
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test-refresh-token
      responses:
        '200':
          description: 토큰 재발급 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '400':
          description: 잘못된 요청 (refreshToken 필드 누락 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 잘못된 요청입니다.
        '401':
          description: |
            유효하지 않은 리프레시 토큰  
            - 만료된 토큰  
            - 위조된 토큰  
            - DB에 저장된 토큰과 불일치하는 경우 등
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 리프레시 토큰이 만료되었거나 유효하지 않습니다.

  /api/auth/find-id:
    post:
      tags: [Auth]
      summary: 아이디(이메일) 찾기
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
                  example: testuser@example.com
      responses:
        '200':
          description: 아이디 찾기 성공 (해당 이메일로 가입된 사용자 존재)
        '400':
          description: 잘못된 요청 (이메일 형식 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 잘못된 요청입니다.
        '404':
          description: 등록된 이메일이 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 등록된 이메일이 없습니다.

  /api/auth/reset-password:
    post:
      tags: [Auth]
      summary: 비밀번호 재설정
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, newPassword, confirmPassword]
              properties:
                email:
                  type: string
                  format: email
                  example: testuser@example.com
                newPassword:
                  type: string
                  format: password
                  example: Newpass123!
                confirmPassword:
                  type: string
                  format: password
                  example: Newpass123!
      responses:
        '200':
          description: 비밀번호 재설정 성공
        '400':
          description: |
            잘못된 요청 또는 유효성 검사 실패  
            - 비밀번호/재확인 불일치  
            - 비밀번호 형식 오류  
            - 비밀번호 재설정을 위한 이메일 인증 미완료 등
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 비밀번호 재설정을 위한 이메일 인증이 필요합니다.
        '404':
          description: 등록된 이메일이 없음 (사용자를 찾을 수 없음)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 404
                error: NotFound
                message: 등록된 이메일이 없습니다.

  /api/users/me:
    get:
      tags: [Users]
      summary: 내 정보 조회
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 내 정보 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.

    patch:
      tags: [Users]
      summary: 내 정보 수정
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nickname:
                  type: string
                  example: testUserUpdated
      responses:
        '200':
          description: 내 정보 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: 잘못된 요청 (닉네임/주소 형식 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                error: BadRequest
                message: 잘못된 요청입니다.
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.

    delete:
      tags: [Users]
      summary: 회원 탈퇴
      security:
        - bearerAuth: []
      responses:
        '204':
          description: 회원 탈퇴 성공
        '401':
          description: 인증 필요 (액세스 토큰 누락 또는 유효하지 않은 경우)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                error: Unauthorized
                message: 인증이 필요합니다.
